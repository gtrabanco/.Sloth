#!/usr/bin/env bash

GITIGNORE_FILE="$DOTFILES_PATH/.gitignore"

call_sed() {
  local SED_BIN
  if command -v gsed &>/dev/null; then
    SED_BIN="$(command -v gsed)"
  elif [[ -f "/usr/local/opt/gnu-sed/libexec/gnubin/sed" ]]; then
    SED_BIN="/usr/local/opt/gnu-sed/libexec/gnubin/sed"
  elif command -v sed &>/dev/null; then
    SED_BIN="$(command -v sed)"
  else
    return 1
  fi

  "$SED_BIN" "$@" 
}

[[ ! -f "${DOTFILES_PATH:-}/.gitignore" ]] && "${SLOTH_PATH:-$DOTLY_PATH}/bin/dot" symlinks update v2.0.0
{
  call_sed -i '/^# END OF DOTLY GITIGNORE$/i bin/semver' "$GITIGNORE_FILE" &&
  output::solution ".gitignore file updated"
} || {
  if [[ -n "$(command -v output::error)" ]]; then
    output::error '.gitignore could not be modified'
    output::write 'Add this line:'
    output::answer 'bin/semver'
  fi
}
